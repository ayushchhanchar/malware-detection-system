const express = require('express');
const ScanResult = require('../models/ScanResult');
const router = express.Router();

// Route to block or unblock an IP address
router.post('/block-ip', async (req, res) => {
  const { ipAddress, block } = req.body; // 'block' is a boolean to indicate block/unblock

  try {
    // Update all records with this IP address
    await ScanResult.updateMany({ ipAddress }, { blocked: block });
    res.json({ message: `IP ${ipAddress} has been ${block ? 'blocked' : 'unblocked'}.` });
  } catch (error) {
    res.status(500).json({ message: 'Error updating IP status', error: error.message });
  }
});

// Route to retrieve blocked IPs
router.get('/blocked-ips', async (req, res) => {
  try {
    const blockedIPs = await ScanResult.find({ blocked: true }).distinct('ipAddress');
    res.json(blockedIPs);
  } catch (error) {
    res.status(500).json({ message: 'Error fetching blocked IPs', error: error.message });
  }
});

module.exports = router;
